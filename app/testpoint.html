<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="./assets/css/all.css">
<link rel="stylesheet" href="./assets/css/pages/dictionary.css">
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.12/vue.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vuex/3.6.2/vuex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/MotionPathPlugin.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/ScrollTrigger.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.js' integrity='sha512-otOZr2EcknK9a5aa3BbMR9XOjYKtxxscwyRHN6zmdXuRfJ5uApkHB7cz1laWk2g8RKLzV9qv/fl3RPwfCuoxHQ==' crossorigin='anonymous'></script>
<script src="./assets/js/all.js"></script>
<script src="./assets/js/utils.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>

<title>test</title>
</head>
<style>

</style>

<body>
  <div id="dictionary">
    <vue-header></vue-header>
    <main class="container dictionary pt-25 pb-15">
      <h2>modalTest</h2>
      <div class="container">
        <div class="row mt-20 ml-20">
          <button class=" btn" @click="sendPoint">登入</button>
          <!-- <button class="btn" @click="orderConfirm">訂單成立</button> -->
          <button class="btn" @click="memberStatus">會員狀態變更</button>
          <button class="btn" @click="memberStatus2">會員消費變更</button>
          <button class="btn" @click="nowProduct">目前車車</button>
        </div>
      </div>
    </main>











    @@include('./components/Footer.html')
  </div>


  @@include('./components/VueHeader.html') @@include('./components/ModalNormal.html')
  <!--  -->
  <script src="./assets/js/mixins/cartMixins.js"></script>
  <!--  -->


  <script>
    new Vue({
      el: '#dictionary',
      store,
      mixins: [cartMixins],
      data() {
        return {
          userData: '',
        }
      },
      methods: {

        sendPoint() {
          const params = new URLSearchParams()
          params.append('ID', this.memberId)

          axios({
            method: 'post',
            url: 'assets/php/setMemberCoupon.php',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            data: params,
          }).then((res) => {
            console.log(res);
          }).catch((error) => {
            console.log(error)

          })
        },
        orderConfirm() {

          let templateParams = {
            "order_id": this.userData.birthday,
            "userMail": this.userData.account,
            "reply_to": "wow",
          }
          let service_id = "service_nc71unc";
          let template_id = "template_n6r3opy";
          let userID = "user_TzSSXb2sF6bb0qvrAeRv0";
          emailjs.send(service_id, template_id, templateParams, userID)
            .then((response) => {
              console.log('SUCCESS! 寄出驗證信');
            })
            .catch((error) => {
              console.log('FAILED...', error);
            })

        },
        memberStatus() {

          const params = new URLSearchParams()
          params.append('ID', this.memberId)
          params.append('ORDER_ID', 4442027)
          axios({
            method: 'post',
            url: 'assets/php/updateMemberCost.php',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            data: params,
          }).then((res) => {
            console.log(res);
          }).catch((error) => {
            console.log(error)

          })


        },
        memberStatus2() {


          // 抓取會員現有點數
          const params = new URLSearchParams()
          params.append('ID', this.memberId)
          axios({
            method: 'post',
            url: 'assets/php/getMemberPoints.php',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            data: params,

          }).then((res) => {

            let memberPoints = res.data[0]['member_points'];
            // console.log(memberPoints)
            if (memberPoints == null) {
              memberPoints = 0;
              console.log(memberPoints)
              this.memberPoints = parseInt(memberPoints);
              this.$store.commit('setMemberPoint', this.memberPoints);
            } else {
              memberPoints = memberPoints;
              console.log(memberPoints)
              this.memberPoints = parseInt(memberPoints);
              this.$store.commit('setMemberPoint', this.memberPoints);
            };
            // console.log(memberPoints);
          }).catch((error) => {
            console.log(error)

          })


        },


      },
      computed: {


        memberId() {
          return this.$store.state.memberId
        },

      },
      mounted() {

        const params = new URLSearchParams()
        params.append('ID', this.memberId)


        axios({
          method: 'post',
          url: 'assets/php/getMemberInfoNoFunction.php',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          data: params,
        }).then((res) => {
          console.log(res.data)
          let newData;
          newData = res.data.map((item) => {

            return {
              name: item.member_name,
              account: item.member_account,
              gender: item.member_gender,
              address: item.member_address,
              birthday: item.member_birthday,
              phone: item.member_phone,
              photo: item.member_photo,
              password: item.member_pwd,
            }
          });
          this.userData = newData[0];

        }).catch((error) => {
          console.log(error)
        })

      },




    });
  </script>
</body>

</html>