<template id="member_coupon">
  <div class=" container">
    <div class="row member__info">
      <section class="member__data col-12 col-lg-6 col-xs-12">
        <h2
          class="block  block__header__title"
          id="memberCoupon"
        >我的折價卷</h2>
      </section>
    </div>
    <div class="row member__info d-flex justify-content-around py-10">
      <div
        class="member__cupon  mt-5  col-5 col-lg-6"
        v-for="(item,index) of  couponList"
      >
        <ul class="d-flex justify-content-center w-100 ">
          <li class="member__cuponText">
            <div class="member__cuponBackGround">
              <!-- <span class="member__cuponText--big">{{item['couponHightLine']}}</span> -->
              </span class="member__cuponText--small">{{item['couponHightLine']}}</span>
            </div>
          </li>
          <li class="member__cuponText">
            <div class="member__cuponContent">
              <p class="h5">【{{item['couponTitle']}}】</p>
              <p class="h4">{{item['couponText']}}</p>
              <p class=" h4 member__cuponContent--warning ">即將到期:<span> {{item.couponDeadDate}}</span></p>
            </div>
          </li>
          <li class="member__cuponText">
            <a
              class="member__cuponBtn"
              href="./product.html"
            ><button class="btn btn--link   member__cuponBtn--black pb-5 ">去逛逛</button>
            </a>
          </li>
        </ul>
      </div>

    </div>
  </div>

</template>

<script>
  Vue.component('member_coupon', {

    template: '#member_coupon',
    data() {
      return {
        couponList: [],
        count: null,


      }
    },
    mounted() {

      const params = new URLSearchParams()
      params.append('ID', this.memberId)

      axios({
        method: 'post',
        url: 'assets/php/getMemberCoupon.php',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        data: params,
      }).then((res) => {
        console.log(res.data)

        this.couponList = res.data.map((coupon) => {

          let hightLine;

          coupon.coupon_id == "0" ? hightLine = "九折" : coupon.coupon_id == "1" ? hightLine = "免運" : coupon.coupon_id == "2" ? hightLine = "買一送一" : coupon.coupon_id == "3" ? hightLine = "七折" : hightLine = "???"

          return {
            couponTitle: coupon.coupon_name,
            couponId: coupon.coupon_id,
            couponText: coupon.coupon_des,
            coupon_On: coupon.coupon_type,
            couponGetDate: coupon.type_date,
            couponDeadDate: coupon.dead_date,
            couponHightLine: hightLine,

          }



        })


      }).catch((error) => {
        console.log(error)
      })





    },
    methods: {},
    computed: {
      memberId() {
        return this.$store.state.memberId
      },
      getDate() {
        return Date.parse(this.couponList[0].couponGetDate);
      },
      deadDate() {
        return Date.parse(this.couponList[0].couponDeadDate);
      },

    },
    updated() {


      let i = 0;
      let diff;
      setInterval(() => {
          i += 1;
          let future = this.deadDate;
          let now = this.getDate + i;

          diff = future - now;



          let hours = Math.floor((diff / (1000 * 60 * 60)));
          let min = Math.floor((diff / 60) % 60);
          let secs = Math.floor(diff % 60);

          console.log(hours, min, secs)



        },
        1000);






    }






  })
</script>